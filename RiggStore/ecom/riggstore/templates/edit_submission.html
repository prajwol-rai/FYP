{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h2>Edit Game Submission</h2>
    
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="card mt-4">
            <div class="card-header">
                <h4>Edit {{ submission.title }}</h4>
            </div>
            
            <div class="card-body">
                <!-- Game Title -->
                <div class="form-group">
                    <label for="id_title">Game Title</label>
                    <input type="text" class="form-control" id="id_title" name="title" 
                           value="{{ submission.title }}" required>
                </div>
                
                <!-- Game Description -->
                <div class="form-group">
                    <label for="id_description">Game Description</label>
                    <textarea class="form-control" id="id_description" name="description" rows="4" required>{{ submission.description }}</textarea>
                </div>
                
                <!-- Game Price -->
                <div class="form-group">
                    <label for="id_price">Game Price (NPR)</label>
                    <input type="number" class="form-control" id="id_price" name="price" 
                           value="{{ submission.price }}" step="0.01" min="0" required>
                </div>

                <!-- Game Version -->
                <div class="form-group">
                    <label for="id_version">Game Version</label>
                    <input type="text" class="form-control" id="id_version" name="version" 
                           value="{{ submission.version }}" required>
                </div>

                <!-- Minimum Requirements -->
                <h5>Minimum Requirements</h5>
                <div class="form-group">
                    <label for="id_min_os">OS</label>
                    <select class="form-control" id="id_min_os" name="min_os" required>
                        <option value="">Select OS</option>
                        <option value="Windows 10" {% if submission.min_os == "Windows 10" %}selected{% endif %}>Windows 10</option>
                        <option value="Windows 11" {% if submission.min_os == "Windows 11" %}selected{% endif %}>Windows 11</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="id_min_processor">Processor</label>
                    <select class="form-control" id="id_min_processor" name="min_processor" required>
                        <option value="">Select Processor</option>
                        <option value="Intel Core i3" {% if submission.min_processor == "Intel Core i3" %}selected{% endif %}>Intel Core i3</option>
                        <option value="Intel Core i5" {% if submission.min_processor == "Intel Core i5" %}selected{% endif %}>Intel Core i5</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="id_min_ram">Memory</label>
                    <select class="form-control" id="id_min_ram" name="min_ram" required>
                        <option value="">Select RAM</option>
                        <option value="4 GB" {% if submission.min_ram == "4 GB" %}selected{% endif %}>4 GB</option>
                        <option value="8 GB" {% if submission.min_ram == "8 GB" %}selected{% endif %}>8 GB</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="id_min_gpu">Graphics</label>
                    <select class="form-control" id="id_min_gpu" name="min_gpu" required>
                        <option value="">Select GPU</option>
                        <option value="NVIDIA GTX 660" {% if submission.min_gpu == "NVIDIA GTX 660" %}selected{% endif %}>NVIDIA GTX 660</option>
                        <option value="AMD Radeon HD 7850" {% if submission.min_gpu == "AMD Radeon HD 7850" %}selected{% endif %}>AMD Radeon HD 7850</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="id_min_directx">DirectX</label>
                    <select class="form-control" id="id_min_directx" name="min_directx" required>
                        <option value="">Select DirectX</option>
                        <option value="11" {% if submission.min_directx == "11" %}selected{% endif %}>Version 11</option>
                        <option value="12" {% if submission.min_directx == "12" %}selected{% endif %}>Version 12</option>
                    </select>
                </div>
                
                <!-- Recommended Requirements -->
                <h5>Recommended Requirements</h5>
                <div class="form-group">
                    <label for="id_rec_os">OS</label>
                    <select class="form-control" id="id_rec_os" name="rec_os" required>
                        <option value="">Select OS</option>
                        <option value="Windows 10" {% if submission.rec_os == "Windows 10" %}selected{% endif %}>Windows 10</option>
                        <option value="Windows 11" {% if submission.rec_os == "Windows 11" %}selected{% endif %}>Windows 11</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="id_rec_processor">Processor</label>
                    <select class="form-control" id="id_rec_processor" name="rec_processor" required>
                        <option value="">Select Processor</option>
                        <option value="Intel Core i5" {% if submission.rec_processor == "Intel Core i5" %}selected{% endif %}>Intel Core i5</option>
                        <option value="AMD Ryzen 5" {% if submission.rec_processor == "AMD Ryzen 5" %}selected{% endif %}>AMD Ryzen 5</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="id_rec_ram">Memory</label>
                    <select class="form-control" id="id_rec_ram" name="rec_ram" required>
                        <option value="">Select RAM</option>
                        <option value="8 GB" {% if submission.rec_ram == "8 GB" %}selected{% endif %}>8 GB</option>
                        <option value="16 GB" {% if submission.rec_ram == "16 GB" %}selected{% endif %}>16 GB</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="id_rec_gpu">Graphics</label>
                    <select class="form-control" id="id_rec_gpu" name="rec_gpu" required>
                        <option value="">Select GPU</option>
                        <option value="NVIDIA RTX 3060" {% if submission.rec_gpu == "NVIDIA RTX 3060" %}selected{% endif %}>NVIDIA RTX 3060</option>
                        <option value="AMD Radeon RX 6700" {% if submission.rec_gpu == "AMD Radeon RX 6700" %}selected{% endif %}>AMD Radeon RX 6700</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="id_rec_directx">DirectX</label>
                    <select class="form-control" id="id_rec_directx" name="rec_directx" required>
                        <option value="">Select DirectX</option>
                        <option value="12" {% if submission.rec_directx == "12" %}selected{% endif %}>Version 12</option>
                    </select>
                </div>

                <!-- Categories Section -->
                <div class="form-group">
                    <label>Categories</label>
                    <div class="category-checkboxes">
                        {% for category in categories %}
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" 
                                   name="categories" value="{{ category.id }}"
                                   id="category_{{ category.id }}"
                                   {% if category in submission.categories.all %}checked{% endif %}>
                            <label class="form-check-label" for="category_{{ category.id }}">
                                {{ category.name }}
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- File Uploads -->
                <div class="form-group">
                    <label for="id_thumbnail">Thumbnail Image</label>
                    <div class="custom-file">
                        <input type="file" class="custom-file-input" id="id_thumbnail" name="thumbnail" accept="image/*">
                        <label class="custom-file-label" for="id_thumbnail">Choose main thumbnail (leave blank to keep current)</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="id_game_file">Game File (ZIP)</label>
                    <div class="custom-file">
                        <input type="file" class="custom-file-input" id="id_game_file" name="game_file" accept=".zip">
                        <label class="custom-file-label" for="id_game_file">Choose ZIP file (leave blank to keep current)</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="id_trailer">Game Trailer</label>
                    <div class="custom-file">
                        <input type="file" class="custom-file-input" id="id_trailer" name="trailer" accept="video/*">
                        <label class="custom-file-label" for="id_trailer">Choose video file (leave blank to keep current)</label>
                    </div>
                </div>

                <div class="mt-4">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <a href="{% url 'developer_dashboard' %}" class="btn btn-secondary">
                        Cancel
                    </a>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // File input labels
        const fileInputs = document.querySelectorAll('.custom-file-input');
        fileInputs.forEach(input => {
            input.addEventListener('change', function(e) {
                const fileName = e.target.files[0] ? e.target.files[0].name : 'No file chosen';
                const label = this.nextElementSibling;
                label.textContent = fileName;
            });
        });
    
        // Price validation
        const priceInput = document.getElementById('id_price');
        priceInput.addEventListener('input', function(e) {
            const value = parseFloat(e.target.value);
            if (value < 0) e.target.value = 0;
        });
    });
    </script>
{% endblock %}